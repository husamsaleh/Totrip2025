{% extends "base.html" %}
{% load static %}
{% load wagtailcore_tags %}

{% block title %}{{ tour_guide.user.get_full_name|default:tour_guide.user.username }} | استكشف السعودية{% endblock %}

{% block extra_css %}
<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .animate-float {
        animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }

    /* Image Loading Animation */
    img {
        transition: opacity 0.3s ease-in-out;
    }
    
    img[loading] {
        opacity: 0;
    }
    
    /* Add loading skeleton effect */
    .skeleton {
        animation: skeleton-loading 1s linear infinite alternate;
    }
    
    @keyframes skeleton-loading {
        0% {
            background-color: #E5E7EB;
        }
        100% {
            background-color: #F3F4F6;
        }
    }

    /* Update profile image styles */
    .profile-image {
        position: relative;
        width: 12rem;
        height: 12rem;
    }

    .profile-image::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 9999px;
        background: linear-gradient(45deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
        background-size: 200% 200%;
        animation: shimmer 1.5s infinite;
        z-index: 0;
    }

    .profile-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        z-index: 2;
    }

    .profile-image img {
        position: relative;
        z-index: 2;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .profile-image img.loaded {
        opacity: 1;
    }

    /* Add this new style for the status indicator */
    .status-indicator {
        position: absolute;
        bottom: 4px;
        right: 4px;
        z-index: 3; /* Higher than the profile image */
    }

    .banner-image {
        background-color: #065f46;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Profile -->
<div class="relative min-h-[50vh] bg-gradient-to-b from-emerald-600 to-emerald-800 overflow-hidden">
    <!-- Background image -->
    <div class="absolute inset-0 banner-image">
        {% if tour_guide.banner_image %}
            <img src="{{ tour_guide.banner_image.file.url }}" 
                 alt="صورة الغلاف"
                 class="w-full h-full object-cover opacity-20"
                 loading="eager">
        {% endif %}
    </div>

    <!-- Decorative Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-emerald-500 rounded-full opacity-20"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-emerald-400 rounded-full opacity-20"></div>
    </div>

    <!-- Profile Content -->
    <div class="container mx-auto px-4 pt-10 pb-20 relative z-10">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <!-- Profile Image -->
                <div class="relative profile-image">
                    <div class="profile-image-container rounded-full overflow-hidden ring-8 ring-white/20">
                        {% if tour_guide.profile_image %}
                            <img src="{{ tour_guide.profile_image.file.url }}" 
                                 alt="صورة المرشد"
                                 class="w-full h-full object-cover"
                                 loading="eager">
                        {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ tour_guide.user.get_full_name|default:tour_guide.user.username }}&background=10B981&color=fff&size=200" 
                                 alt="صورة المرشد"
                                 class="w-full h-full object-cover"
                                 loading="eager">
                        {% endif %}
                    </div>
                    {% if tour_guide.is_verified %}
                        <span class="status-indicator w-5 h-5 bg-green-500 rounded-full ring-4 ring-white"></span>
                    {% endif %}
                </div>

                <!-- Profile Info -->
                <div class="text-center md:text-right">
                    <div class="flex items-center justify-center md:justify-start gap-3 mb-2">
                        <h1 class="text-4xl font-bold text-white">{{ tour_guide.user.get_full_name|default:tour_guide.user.username }}</h1>
                        {% if tour_guide.is_verified %}
                            <span class="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-sm">
                                <i class="fas fa-check-circle ml-1"></i>
                                معتمد
                            </span>
                        {% endif %}
                    </div>
                    <p class="text-emerald-100 text-lg mb-4">{{ tour_guide.bio|truncatechars:100 }}</p>
                    <div class="flex items-center justify-center md:justify-start gap-6 text-emerald-100">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-star text-yellow-400"></i>
                            <span>{{ avg_rating }}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-users"></i>
                            <span>{{ review_count }}+ عميل</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-route"></i>
                            <span>{{ packages.count }}+ رحلة</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-clock"></i>
                            <span>خبرة {{ tour_guide.years_of_experience }} سنوات</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="md:mr-auto flex gap-4">
                    <a href="#packages" class="px-8 py-3 bg-white text-emerald-600 rounded-xl hover:bg-emerald-50 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-calendar-check ml-2"></i>
                        حجز رحلة
                    </a>
                    {% if request.user.is_authenticated %}
                    <a href="#contact" class="px-8 py-3 bg-emerald-700 text-white rounded-xl hover:bg-emerald-600 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-comment-dots ml-2"></i>
                        تواصل معي
                    </a>
                    {% else %}
                    <a href="{% url 'users:login' %}?next={{ request.path }}" class="px-8 py-3 bg-emerald-700 text-white rounded-xl hover:bg-emerald-600 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-sign-in-alt ml-2"></i>
                        سجل الدخول للتواصل
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <!-- Social Links -->
            <div class="flex justify-center md:justify-start gap-4 mt-6">
                {% if request.user.is_authenticated %}
                    {% if tour_guide.twitter %}
                    <a href="{{ tour_guide.twitter }}" target="_blank" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all duration-300 hover:-translate-y-1">
                        <i class="fab fa-twitter"></i>
                    </a>
                    {% endif %}
                    
                    {% if tour_guide.instagram %}
                    <a href="{{ tour_guide.instagram }}" target="_blank" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all duration-300 hover:-translate-y-1">
                        <i class="fab fa-instagram"></i>
                    </a>
                    {% endif %}
                    
                    {% if tour_guide.linkedin %}
                    <a href="{{ tour_guide.linkedin }}" target="_blank" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all duration-300 hover:-translate-y-1">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    {% endif %}
                    
                    {% if tour_guide.website %}
                    <a href="{{ tour_guide.website }}" target="_blank" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all duration-300 hover:-translate-y-1">
                        <i class="fas fa-globe"></i>
                    </a>
                    {% endif %}
                    
                    {% if tour_guide.phone_number %}
                    <a href="https://wa.me/{{ tour_guide.phone_number|cut:'+' }}" target="_blank" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all duration-300 hover:-translate-y-1">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    {% endif %}
                {% else %}
                    <div class="bg-white/10 px-4 py-2 rounded-lg text-white text-sm">
                        <i class="fas fa-lock ml-2"></i>
                        سجل الدخول لرؤية وسائل التواصل الاجتماعي
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container mx-auto px-4 py-8">
    <!-- Stats Section - Full Width -->
    <div class="max-w-7xl mx-auto mb-8">
        <div class="bg-white rounded-2xl shadow-xl p-6 grid grid-cols-4 gap-6">
            <div class="text-center">
                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-clock text-emerald-600"></i>
                </div>
                <div class="font-bold text-2xl text-gray-800">{{ tour_guide.years_of_experience }} سنوات</div>
                <div class="text-sm text-gray-500">خبرة</div>
            </div>
            <div class="text-center">
                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-route text-emerald-600"></i>
                </div>
                <div class="font-bold text-2xl text-gray-800">{{ packages.count }}+</div>
                <div class="text-sm text-gray-500">رحلات</div>
            </div>
            <div class="text-center">
                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-users text-emerald-600"></i>
                </div>
                <div class="font-bold text-2xl text-gray-800">{{ review_count }}+</div>
                <div class="text-sm text-gray-500">عملاء</div>
            </div>
            <div class="text-center">
                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-star text-emerald-600"></i>
                </div>
                <div class="font-bold text-2xl text-gray-800">{{ avg_rating }}</div>
                <div class="text-sm text-gray-500">التقييم</div>
            </div>
        </div>
    </div>

    <!-- Main Grid Layout -->
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-8">
            <!-- Price Card -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">السعر اليومي</h3>
                    <div class="text-4xl font-bold text-emerald-600 mb-4">
                        {% with min_price=packages.0.price %}
                            {{ min_price }} ريال
                        {% endwith %}
                    </div>
                    <a href="#packages" class="w-full px-6 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-500 transition-all duration-300 mb-4 inline-block">
                        <i class="fas fa-calendar-check ml-2"></i>
                        احجز الآن
                    </a>
                    {% if request.user.is_authenticated %}
                    <a href="#contact" class="w-full px-6 py-3 border-2 border-emerald-600 text-emerald-600 rounded-xl hover:bg-emerald-50 transition-all duration-300 inline-block">
                        <i class="fas fa-comment-dots ml-2"></i>
                        تواصل معي
                    </a>
                    {% else %}
                    <a href="{% url 'users:login' %}?next={{ request.path }}" class="w-full px-6 py-3 border-2 border-emerald-600 text-emerald-600 rounded-xl hover:bg-emerald-50 transition-all duration-300 inline-block">
                        <i class="fas fa-sign-in-alt ml-2"></i>
                        سجل دخول للتواصل
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Expertise Card -->
            <div class="bg-white rounded-2xl shadow-xl p-6 hover:shadow-2xl transition-all duration-300 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-award text-emerald-600 ml-2"></i>
                    مجالات التخصص
                </h3>
                <div class="flex flex-wrap gap-2">
                    {% for specialty in tour_guide.specialties.all %}
                        <span class="px-4 py-2 bg-emerald-50 text-emerald-600 rounded-xl text-sm">{{ specialty.name }}</span>
                    {% endfor %}
                </div>
            </div>

            <!-- Languages Card -->
            <div class="bg-white rounded-2xl shadow-xl p-6 hover:shadow-2xl transition-all duration-300 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-language text-emerald-600 ml-2"></i>
                    اللغات
                </h3>
                <div class="space-y-4">
                    {% for language in tour_guide.languages.all %}
                        <div class="flex items-center justify-between">
                            <span class="font-medium">{{ language.name }}</span>
                            <div class="flex gap-1">
                                {% for _ in '12345' %}
                                    <i class="fas fa-star {% if forloop.counter <= 5 %}text-yellow-400{% else %}text-gray-300{% endif %}"></i>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Cities Card -->
            <div class="bg-white rounded-2xl shadow-xl p-6 hover:shadow-2xl transition-all duration-300">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-map-marker-alt text-emerald-600 ml-2"></i>
                    المدن التي أغطيها
                </h3>
                <div class="space-y-4">
                    {% for schedule in schedules %}
                        <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                            <div class="w-12 h-12 rounded-lg bg-emerald-100 flex items-center justify-center">
                                <i class="fas fa-city text-emerald-600"></i>
                            </div>
                            <div>
                                <span class="font-medium block">{{ schedule.location.name }}</span>
                                <span class="text-sm text-gray-500">{{ schedule.start_date|date:"d/m/Y" }} - {{ schedule.end_date|date:"d/m/Y" }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="lg:col-span-2 space-y-8">
            <!-- About Me -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-user text-emerald-600 ml-2"></i>
                    نبذة عني
                </h3>
                <p class="text-gray-600 leading-relaxed">
                    {{ tour_guide.bio }}
                </p>
            </div>

            <!-- Packages -->
            <div id="packages" class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-box text-emerald-600 ml-2"></i>
                    الباقات والعروض
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for package in packages %}
                        <div class="group relative overflow-hidden rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 p-6 text-white transition-all duration-300 hover:-translate-y-1">
                            <div class="absolute inset-0 opacity-20">
                                <div class="w-full h-full bg-emerald-700"></div>
                            </div>
                            <div class="relative z-10">
                                <div class="flex items-center gap-2 mb-4">
                                    <i class="fas fa-clock text-emerald-200"></i>
                                    <span class="text-sm">{{ package.duration }}</span>
                                </div>
                                <h4 class="text-xl font-bold mb-2">{{ package.title }}</h4>
                                <p class="text-emerald-100 mb-4 text-sm">{{ package.description|truncatechars:80 }}</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-2xl font-bold">{{ package.price }} ريال</span>
                                    <button class="px-4 py-2 bg-white text-emerald-600 rounded-lg hover:bg-emerald-50 transition-all duration-300">
                                        احجز الآن
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Gallery with Lightbox -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-images text-emerald-600 ml-2"></i>
                    معرض الصور والفيديو
                </h3>
                
                <!-- Gallery Tabs -->
                <div class="flex gap-4 mb-6" id="gallery-tabs">
                    <button class="px-6 py-2 bg-emerald-500 text-white rounded-lg" data-tab="images-tab">الصور</button>
                    <button class="px-6 py-2 text-gray-600 hover:bg-gray-100 rounded-lg" data-tab="videos-tab">الفيديو</button>
                </div>

                <!-- Images Grid -->
                <div id="images-tab" class="tab-content grid grid-cols-1 md:grid-cols-3 gap-4">
                    {% for image in gallery %}
                        <div class="group relative overflow-hidden rounded-xl gallery-item cursor-pointer">
                            <img src="{{ image.image.file.url }}" 
                                 class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-110" 
                                 alt="{{ image.title }}">
                            <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                <span class="p-2 bg-white/20 hover:bg-white/30 rounded-full text-white transition-all duration-300">
                                    <i class="fas fa-expand-alt"></i>
                                </span>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-span-3 text-center py-10 text-gray-500">
                            <i class="fas fa-image text-gray-300 text-5xl mb-3"></i>
                            <p>لا توجد صور في المعرض حالياً</p>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Videos Grid -->
                <div id="videos-tab" class="tab-content hidden grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for video in videos %}
                        <div class="overflow-hidden rounded-xl border border-gray-100 hover:shadow-md transition-all">
                            <div class="aspect-w-16 aspect-h-9">
                                <iframe 
                                    src="{{ video.get_embed_url }}" 
                                    title="{{ video.title }}"
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <div class="p-4">
                                <h4 class="font-bold text-gray-800">{{ video.title }}</h4>
                                {% if video.description %}
                                <p class="text-gray-500 text-sm mt-2">{{ video.description|truncatechars:100 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-span-2 text-center py-10 text-gray-500">
                            <i class="fas fa-video text-gray-300 text-5xl mb-3"></i>
                            <p>لا توجد مقاطع فيديو حالياً</p>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Reviews with Better Structure -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-comments text-emerald-600 ml-2"></i>
                        التقييمات
                    </h3>
                    <a href="{% url 'tourguides:tourguide_reviews' slug=tour_guide.slug %}" class="text-emerald-600 hover:text-emerald-700 transition-colors">
                        عرض الكل
                        <i class="fas fa-arrow-left mr-1"></i>
                    </a>
                </div>
                <div class="space-y-6">
                    {% for review in reviews|slice:":2" %}
                        <div class="border-b border-gray-100 pb-6">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center">
                                    <span class="text-emerald-600 font-bold text-xl">{{ review.author_name|slice:":1" }}</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-bold text-gray-800">{{ review.author_name }}</h4>
                                        <span class="text-sm text-gray-500">{{ review.created_at|date:"d M Y" }}</span>
                                    </div>
                                    <div class="flex text-yellow-400 mb-2">
                                        {% for _ in '12345' %}
                                            <i class="fas fa-star {% if forloop.counter <= review.rating %}text-yellow-400{% else %}text-gray-300{% endif %}"></i>
                                        {% endfor %}
                                    </div>
                                    <p class="text-gray-600">{{ review.comment }}</p>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-12">
                            <p class="text-gray-500">لا توجد تقييمات حتى الآن.</p>
                            <a href="{% url 'tourguides:add_review' slug=tour_guide.slug %}" class="mt-4 inline-block bg-emerald-500 text-white px-4 py-2 rounded-lg">
                                أضف تقييمك
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Contact Me Section -->
            <div id="contact" class="bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-envelope text-emerald-600 ml-2"></i>
                    تواصل معي
                </h3>
                
                {% if request.user.is_authenticated %}
                <form class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">الاسم</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">البريد الإلكتروني</label>
                            <input type="email" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition-all">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">الرسالة</label>
                        <textarea rows="4" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition-all resize-none"></textarea>
                    </div>
                    <button type="submit" class="px-8 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-500 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-paper-plane ml-2"></i>
                        إرسال الرسالة
                    </button>
                </form>
                {% else %}
                <div class="text-center py-8">
                    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-lock text-gray-400 text-3xl"></i>
                    </div>
                    <h4 class="text-xl font-medium text-gray-700 mb-3">يجب تسجيل الدخول للتواصل</h4>
                    <p class="text-gray-500 mb-6">سجل دخول أو أنشئ حساباً جديداً للتواصل مع المرشد السياحي</p>
                    <div class="flex justify-center gap-4">
                        <a href="{% url 'users:login' %}?next={{ request.path }}" class="px-6 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-500 transition-all duration-300">
                            <i class="fas fa-sign-in-alt ml-2"></i>
                            تسجيل دخول
                        </a>
                        <a href="{% url 'users:register' %}?next={{ request.path }}" class="px-6 py-3 border-2 border-emerald-600 text-emerald-600 rounded-xl hover:bg-emerald-50 transition-all duration-300">
                            <i class="fas fa-user-plus ml-2"></i>
                            إنشاء حساب
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add Modal for Gallery Lightbox -->
<div id="gallery-modal" class="fixed inset-0 bg-black/90 hidden items-center justify-center z-50">
    <button class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300" id="close-modal">
        <i class="fas fa-times"></i>
    </button>
    <div class="max-w-7xl w-full p-4">
        <img src="" class="max-h-[85vh] mx-auto rounded-lg" id="modal-image">
    </div>
    <div class="text-white text-center mt-4">
        <p id="modal-caption" class="text-lg"></p>
    </div>
</div>

<!-- Tab Functionality Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Setup tabs functionality
        const tabButtons = document.querySelectorAll('#gallery-tabs button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Deactivate all tabs
                tabButtons.forEach(btn => {
                    btn.classList.remove('bg-emerald-500', 'text-white');
                    btn.classList.add('text-gray-600', 'hover:bg-gray-100');
                });
                
                // Activate clicked tab
                button.classList.add('bg-emerald-500', 'text-white');
                button.classList.remove('text-gray-600', 'hover:bg-gray-100');
                
                // Hide all content
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show selected content
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.remove('hidden');
            });
        });
        
        // Handle eager loading images (profile and banner) separately
        document.querySelectorAll('img[loading="eager"]').forEach(img => {
            // Add loaded class immediately if image is already loaded
            if (img.complete) {
                img.classList.add('loaded');
            } else {
                // Add loaded class when image loads
                img.onload = function() {
                    this.classList.add('loaded');
                }
            }
            
            // Handle errors for eager loading images
            img.onerror = function() {
                if (img.alt.includes('صورة')) {
                    this.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(img.alt)}&background=10B981&color=fff&size=200`;
                } else {
                    this.style.display = 'none';
                }
            }
        });

        // Gallery Modal Functionality - IMPROVED
        const galleryItems = document.querySelectorAll('.gallery-item');
        const modal = document.getElementById('gallery-modal');
        const modalImage = document.getElementById('modal-image');
        const modalCaption = document.getElementById('modal-caption');
        const closeModal = document.getElementById('close-modal');

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (modal.classList.contains('flex')) {
                if (e.key === 'Escape') {
                    closeGalleryModal();
                }
            }
        });

        function openGalleryModal(imgSrc, imgAlt) {
            modalImage.src = imgSrc;
            modalCaption.textContent = imgAlt || '';
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // Prevent scrolling when modal is open
        }

        function closeGalleryModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = ''; // Re-enable scrolling
        }

        // Attach click events to gallery items
        galleryItems.forEach(item => {
            item.addEventListener('click', () => {
                const img = item.querySelector('img');
                if (img) {
                    openGalleryModal(img.src, img.alt);
                }
            });
        });

        closeModal.addEventListener('click', closeGalleryModal);

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeGalleryModal();
            }
        });
    });
</script>
{% endblock %} 